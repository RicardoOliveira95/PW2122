<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="/_sidebar.css">
    <link rel="stylesheet" href="/style.css" crossorigin="anonymous"></linkrel>
    
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <title>ASAE | Entidades </title>

    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400">
    <link rel="stylesheet" href="/style.css" crossorigin="anonymous"></linkrel>
    <link href="/_sidebar.scss" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">
    <meta charset="UTF-8">
    <link rel="icon" href="/_img/Imgs/SimboloASAE_personalizado.jpeg.sb-e501c02c-7jNvGZ.png"> 
  </head>
  <body>
    
   
  <div class="lateral_menu" style="position: absolute; height: 135%;">
            <!--Identification of the user who is logged in the system-->
            <div class="identify">
                <img src="/_img/Imgs/1499345621-contact_85338.png" alt="">
                <a href="#" > <h3 style="margin-left: 30%;"> Username logado</h3></a>
                <br>
                <br>
                
                <a href="" style="margin: 5%;"><button class="logoutRevervado" onclick="" style="border: 1px solid #fff; margin-left: 37%; margin-top: 5%;"> <span style="font-size: 12px; text-align: center;padding-left: 2px; "> LogOut </span></button></a> 
            </div>
    
            <!--Options - load new pages-->
            <div class="menuOptions" style="margin-top: 5%">
                
                <!--go to the page with the list of the request not awnser-->
                <div class="options">
                <i class="far fa-clock" style="margin-left: 15%;"></i> 
                <a href="/pedidospendentes" style="margin-top: 6%; margin-left: 25%; margin-bottom: 2.5%"> Gestão de Operações</a>
                <br><br>
            </div>
            
                <div class="options">
                <i class="fas fa-network-wired" style="margin-left: 15%;"></i> 
                <a href="/registaroperacao" style="margin-top: 4.5%;margin-left: 25%;" > Gestão de Ocorrências</a>
                <br><br>
            </div> 
            <div class="options">
                <i class="fas fa-toggle-on" style="margin-left: 15%;"></i>
                <a href="/pedidospendentes" style="margin-top: 4.5%; margin-left: 25%; "> Gestão de Estados</a>
                <br><br>
            </div>
            <div class="options">
                <i class="far fa-address-card" style="margin-left: 15%;"></i>
                <a href="/entidades" style="margin-top: 4%;margin-left: 25%; color: greenyellow; font-size: 22px; " > Entidades</a>
                <br><br>
            </div>
            <div class="options">
                <i class="fas fa-user-secret" style="margin-left: 15%;"></i>
                <a href="/denunciantes" style="margin-top: 4.5%;margin-left: 25%; " > Denunciantes</a>
                <br><br>
            </div>
            <div class="options">
                <i class="far fa-building" style="margin-left: 15%;"></i> 
                <a href="/colaboradores" style="margin-top: 4.5%;margin-left: 25%; "> Colaboradores</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="far fa-address-book" style="margin-left: 15%;"></i> 
                <a href="/operacionais.html" style="margin-top: 4.5%;margin-left: 25%;"> Operacionais</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-hard-hat" style="margin-left: 15%;"></i>
                <a href="/parceiros" style="margin-top: 4.5%;margin-left: 25%;"> Parceiros</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-chart-line" style="margin-left: 15%;"></i> 
                <a href="#" style="margin-top: 4.5%;margin-left: 25%;"> Dashboard </a>
                <br><br>
            </div>
    
            </div>
            
            </div>


   <div class="content_tables" style="height:78%;">



    <div class="pedidosPendentes" style="position: absolute; display: inline;">
        <h1 style="font-style: italic;">Entidades</h1> <img src="/_img/Imgs/Sem nome.png" alt="" style="display: inline; width: 60px; height: 30px; position: absolute;">            
     
    </div>
    
    <div class="search" style="font-size: 12px; position:absolute; width: 15px; margin-top:12.5%; margin-left: 72%">
        Search:
    </div>  
    
    <style>
        .dataTables_wrapper .dataTables_length select {
            border: 1px solid #aaa;
            border-radius: 3px;
            padding: 5px;
            background-color: transparent;
            padding: 4px;
            width:15%;
            }
            
        .dataTables_wrapper .dataTables_length {
            color: #333;
            margin-left: 80%;
            font-size: 12px;
            width: 300px;
            position: absolute;
            margin-top: -8%;
        }
        
        .dataTables_wrapper .dataTables_filter {
            color: #333;
            margin-left: 200%;
            font-size: 12px;
            width: -0px;
            position: absolute;
            margin-top: -11%;
        }
        
        .dataTables_wrapper .dataTables_filter label{
            color:white;
        }
        
        
   
        
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            /* box-sizing: border-box; */
    display: inline-block;
    /*min-width: 1.5em;*/
    padding: 0px;
    margin-left: 2px;
    text-align: center;
    text-decoration: none !important;
    cursor: pointer;
    cursor: hand;
    color: #333 !important;
    /*border: 1px solid transparent;
    border-radius: 2px;*/
}

.pagination {
    display: -ms-flexbox;
    display: flex;
    padding-left: 0px;
    list-style: none;
    border-radius: .25rem;
    position: absolute;
    margin-left: 42%;
    margin-top: 120%;
    padding-right: 10px;
}
      
      #ent-list_previous{
          margin-right: 49px;
          padding:-20px;
          background-color: white;
         
      } 
      
    .dataTables_wrapper .dataTables_info {
    color: #333;
    margin-left: 100%;
    font-size: 12px;
    margin-top: 160%;
    position: absolute;
    
} 
     
      
   .page-item.active .page-link {
    z-index: 1; 
    z-index: 2;
    z-index: 3;
    z-index: 4;
    color: grey;
    /*border: solid 2px;*/
    background-color: transparent;
    border-color: greenyellow;
    font-weight: bold;
}

.page-item.active .page-link hover{
    background:transparent;
} 


.page-link {
    position: relative;
    display: block;
    padding: .5rem .75rem;
    margin-left: -1px;
    line-height: 1.25;
    color: #29323c;
    background-color: #fff;
    border: 1px solid #dee2e6;
}
    </style>
    
    
    
    
    
    
    <table id="ent-list" class="table table-striped table-bordered" style="width:75%; margin-left:40%; position:absolute; margin-top:1%" >
        
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Entidade</th>
                <th scope="col">Tipo</th>
                <th scope="col">Morada</th>
                <th scope="col">Localização</th>
                <th scope="col">Código-Postal</th>
                <th scope="col">Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <!-- Needed for DataTables -->
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
	


    
    <script>
        function listEnt() {
            let table = $('#ent-list').DataTable();
    
            fetch(`http://3.226.122.100:8080/entities1`, { method: 'GET',
            headers: {'Accept': 'application/json',
                      'Content-Type': 'application/json'}})
            
            .then(res => res.json())
            //.then(json => console.log(json))
            .then((out) => {
                console.log(out);
                $.each(out, function(index, value) {
                    console.log(value);
                    table.row.add([value.idEntity, 
                                    value.NameEntity, 
                                    value.TypeEntity, 
                                    value.Street, 
                                    value.District, 
                                    value.Zip_Code,
                                    '<i class="fas fa-save"></i><i class="far fa-edit"></i><i class="fas fa-trash"></i>']).draw();
                });
            }).catch(err => console.error(err));
        }

        $(document).ready(function() {
            $('#ent-list').DataTable();
			listEnt();
        })
        
       // strHtml += "</tbody>"
       // myDataTable.innerHTML = strHtml

    </script>
    
    
    
    
    
    
    
    


<!--
    <div class="tabela" style="width: 80%; height: 80%;margin-top: 30%; margin-left:-5%">
    <table class="table" id="myDataTable"></table>
</div>
</div>  
       
      
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
 <!--   <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
<!--
    <script type="text/javascript" src="//cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
        $(document).ready( function () {
    $('#myDataTable').DataTable();
} );
    </script>


<!--Editar tabela-->
<!--
<script>
$(".editar").click(function(){
    var id = $(this).data('id');
    var titulo = $(this).data('titulo');
    var autor = $(this).data('autor');
    var categoria = $(this).data('categoria');
    //preenche os campos e chama o modal
})

</script>
 <script type="text/javascript">
	window.onload=()=>{
const myDataTable = document.getElementById("myDataTable")
//GET
const renderEntities = async () => {
        let strHtml = `
            <thead>
            <tr>
                <th>ID</th>
                <th>Entidade</th>
                <th>Tipo</th>
                <th>Morada</th>
                <th>Localização</th>
                <th>Código-Postal</th>
                <th>Ações</th>
                
                <input type="text" placeholder="Search.." name="search" id="query" onkeyup="searchData()">
                <button type="submit" value="search" onclick="searchData()"><i class="fa fa-search" id="searchBar">
                
                
            </tr>
     </thead><tbody>
        `
        const response = await fetch('http://18.205.26.16:8080/entities')
        const entities = await response.json()
        let i = 1
        for (const entity of entities) {            
            strHtml += `<tr>
                    <td id="row${entity.idEntity}"> ${entity.idEntity}</td>
                    <td id="name_row${entity.idEntity}" data-value="${entity.Name}"> ${entity.Name}</td>
                    <td id="type_row${entity.idEntity}"> ${entity.Type}</td>
                    <td id="street_row${entity.idEntity}"> ${entity.Street}</td>
                    <td id="district_row${entity.idEntity}"> ${entity.District}</td>
                    <td id="zipcode_row${entity.idEntity}"> ${entity.Zip_Code}</td>
                    <td><i id='${entity.idEntity}' class='fas fa-trash-alt remove'></i>
                     <p><i class="far fa-edit" id="edit_button${entity.idEntity}" value="Edit" class="edit" onclick="edit_row('${entity.idEntity}')" style="cursor:pointer;"></i>
                    </p>
                    <p><i name="${entity.idEntity}" id="save_button${entity.idEntity}" value="Save" class="fa fa-save" onclick="save_row('${entity.idEntity}')" style="cursor:pointer;"></p></td>
                </tr>`
            i++
        }
        strHtml += "</tbody>"
        myDataTable.innerHTML = strHtml
        
        //Search:id
        const searchBtn = document.getElementById("searchBar")
        searchBtn.addEventListener("click",function(){
        
        const query = document.getElementById("query");
        filter = query.value.toUpperCase();
        var tr = myDataTable.getElementsByTagName("tr");
        // loop table row and hide those that don't match
        //console.log(tr.length)
        for (i = 0; i < tr.length; i++) {
        var td = tr[i].getElementsByTagName("td")[0];
        if (td) {
            console.log("TD")
          const txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        } 
      }
    });
        
        //DELETE
        const btnDelete = document.getElementsByClassName("remove")
        for (let i = 0; i < btnDelete.length; i++) {
            btnDelete[i].addEventListener("click", () => {
                swal({
                    title: 'Tem a certeza?',
                    text: "Nao sera possivel reverter a remocao!",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Remover'
                  }).then( async (result) => {
                    if (result.value) {                        
                        let idEntity = btnDelete[i].getAttribute("id")
                        try {
                            const response = await fetch(`http://18.205.26.16:8080/entities/${idEntity}`, { method: "DELETE"})
                            const entities = await response.json()                            
                            swal('Removido!','A entidade foi removida da tabela.','success')
                            renderEntities()
                        } catch(err) {
                            swal({type: 'error', title: 'Erro', text: err})
                        }
                    } 
                  })
            })
        }
        
         //UPDATE
        const saveBtn = document.getElementsByClassName("fa fa-save")
        for (let i = 0; i < saveBtn.length; i++) {
            saveBtn[i].addEventListener("click", () => {
                console.log("fetch")
                swal({
                    title: 'Tem a certeza?',
                    text: "Esta linha sera alterada na base de dados!",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3075d6',
                    cancelButtonColor: '#d34',
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Alterar'
                  }).then( async (result) => {
                    if (result.value) {                        
                        let idEntity = saveBtn[i].getAttribute("name")
                        var Name=document.getElementById("name_row"+idEntity).innerHTML;
                        var Type=document.getElementById("type_row"+idEntity).innerHTML;
                        var Street=document.getElementById("street_row"+idEntity).innerHTML;
                        var District=document.getElementById("district_row"+idEntity).innerHTML;
                        var Zip_Code=document.getElementById("zipcode_row"+idEntity).innerHTML;
                        console.log(Name+ Type+ Street+ District+ Zip_Code)
                        try {
                            const response = await fetch(`http://18.205.26.16:8080/entities/${idEntity}`, { method: "PUT",body: `Name=${Name}&Type=${Type}&Street=${Street}&District=${District}&ZipCode=${Zip_Code}`,
                                headers: {"Content-type": "application/x-www-form-urlencoded"}})
                            const entities = await response.json()                            
                            swal('Actualizado!','A entidade foi alterada na base de dados.','success')
                        } catch(err) {
                            swal({type: 'error', title: 'Erro', text: err})
                        }
                    } 
                  })
            })
        }
        }
        renderEntities()
    }
    function edit_row(no){
    document.getElementById("edit_button"+no).style.display="none";
    document.getElementById("save_button"+no).style.display="block";

 var name=document.getElementById("name_row"+no);
 var type=document.getElementById("type_row"+no);
 var street=document.getElementById("street_row"+no);
 var district=document.getElementById("district_row"+no);
 var zip_code=document.getElementById("zipcode_row"+no);
 
    
 var nome_data=name.innerHTML;
 var type_data=type.innerHTML;
 var street_data=street.innerHTML;
 var district_data=district.innerHTML;
 var zipcode_data=zip_code.innerHTML;
 
    
 name.innerHTML="<input type='text' id='name_text"+no+"' value='"+nome_data+"'>";
 type.innerHTML="<input type='text' id='type_text"+no+"' value='"+type_data+"'>";
 street.innerHTML="<input type='text' id='street_text"+no+"' value='"+street_data+"'>";
 district.innerHTML="<input type='text' id='district_text"+no+"' value='"+district_data+"'>";
 zip_code.innerHTML="<input type='text' id='zipcode_text"+no+"' value='"+zipcode_data+"'>";
}

function save_row(no){
console.log("save")
 var name_val=document.getElementById("name_text"+no).value;
 var type_val=document.getElementById("type_text"+no).value;
 var street_val=document.getElementById("street_text"+no).value;
 var district_val=document.getElementById("district_text"+no).value;
 var zipcode_val=document.getElementById("zipcode_text"+no).value;
 

 document.getElementById("name_row"+no).innerHTML=name_val;
 document.getElementById("type_row"+no).innerHTML=type_val;
 document.getElementById("street_row"+no).innerHTML=street_val;
 document.getElementById("district_row"+no).innerHTML=district_val;
 document.getElementById("zipcode_row"+no).innerHTML=zipcode_val;
 
 

 document.getElementById("edit_button"+no).style.display="block";
 document.getElementById("save_button"+no).style.display="none";

 var name=document.getElementById("name_row"+no);
 var type=document.getElementById("type_row"+no);
 var street=document.getElementById("street_row"+no);
 var district=document.getElementById("district_row"+no);
 var zip_code=document.getElementById("zipcode_row"+no);
 
}

function searchData(){
    var tbl = document.getElementById("myDataTable");
    var query = document.getElementById("query");
    filter = query.value.toUpperCase();
    var tr = tbl.getElementsByTagName("tr");
    console.log("SEARCH")
    // loop table row and hide those that don't match
    console.log(tr.length)
    for (i = 0; i < tr.length; i++) {
    var td = tr[i].getElementsByTagName("td")[1];
    if (td) {
        console.log("TD")
      const txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    } 
  }
}
</script>

-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.26.9/sweetalert2.all.min.js"></script>
  </body>
</html>
