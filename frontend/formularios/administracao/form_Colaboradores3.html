<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="/_sidebar.css">
    <link rel="stylesheet" href="/style.css" crossorigin="anonymous"></linkrel>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <!--botoes tabela-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css%22%3E">
    
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <title>ASAE | Colaboradores </title>

    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400">
    <link rel="stylesheet" href="/style.css" crossorigin="anonymous"></linkrel>
    <link href="/_sidebar.scss" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">
    <meta charset="UTF-8">
    <link rel="icon" href="/_img/Imgs/SimboloASAE_personalizado.jpeg.sb-e501c02c-7jNvGZ.png"> 
  </head>
  <body>
    
   
      <div class="lateral_menu" style="position: absolute; height: 100%;">
            <!--Identification of the user who is logged in the system-->
            <div class="identify">
                <img src="/_img/Imgs/1499345621-contact_85338.png" alt="">
                <a href="#" > <h3 style="margin-left: 30%;"> Username logado</h3></a>
                <br>
                <br>
                
                <a href="" style="margin: 5%;"><button class="logoutRevervado" onclick="" style="border: 1px solid #fff; margin-left: 37%; margin-top: 5%;"> <span style="font-size: 12px; text-align: center;padding-left: 2px; "> LogOut </span></button></a> 
            </div>
    
            <!--Options - load new pages-->
            <div class="menuOptions" style="margin-top: 5%">
                
                <!--go to the page with the list of the request not awnser-->
                <div class="options">
                <i class="far fa-clock" style="margin-left: 15%;"></i> 
                <a href="/pedidospendentes" style="margin-top: 6%; margin-left: 25%; margin-bottom: 2.5%"> Gestão de Operações</a>
                <br><br>
            </div>
            
                <div class="options">
                <i class="fas fa-network-wired" style="margin-left: 15%;"></i> 
                <a href="/registaroperacao" style="margin-top: 4.5%;margin-left: 25%;" > Gestão de Ocorrências</a>
                <br><br>
            </div> 
            <div class="options">
                <i class="fas fa-toggle-on" style="margin-left: 15%;"></i>
                <a href="/pedidospendentes" style="margin-top: 4.5%; margin-left: 25%; margin-bottom: 3%"> Gestão de Estados</a>
                <br><br>
            </div>
            <div class="options">
                <i class="far fa-address-card" style="margin-left: 15%;"></i>
                <a href="/entidades" style="margin-top: 4.5%;margin-left: 25%;  " > Entidades</a>
                <br><br>
            </div>
            <div class="options">
                <i class="fas fa-user-secret" style="margin-left: 15%;"></i>
                <a href="/denunciantes" style="margin-top: 4.5%;margin-left: 25%; " > Denunciantes</a>
                <br><br>
            </div>
            <div class="options">
                <i class="far fa-building" style="margin-left: 15%;"></i> 
                <a href="/colaboradores" style="margin-top: 4%;margin-left: 25%; color: greenyellow; font-size: 22px;"> Colaboradores</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="far fa-address-book" style="margin-left: 15%;"></i> 
                <a href="/operacionais.html" style="margin-top: 4.5%;margin-left: 25%;"> Operacionais</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-hard-hat" style="margin-left: 15%;"></i>
                <a href="/parceiros" style="margin-top: 4.5%;margin-left: 25%;"> Parceiros</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-chart-line" style="margin-left: 15%;"></i> 
                <a href="#" style="margin-top: 4.5%;margin-left: 25%;"> Dashboard </a>
                <br><br>
            </div>
    
            </div>
            
            </div>

   <div class="content_tables" style="height:78%;">


    <div class="pedidosPendentes" style="position: absolute; display: inline;">
        <h1 style="font-style: italic;">Colaboradores</h1> <img src="/_img/Imgs/Sem nome.png" alt="" style="display: inline; width: 60px; height: 30px; position: absolute;">            
     
    </div>

   <!-- <div class="page-header" >
        <h1>Lista colaboradores</h1>      
    </div>-->
    
 
    <table id="colab-list" class="table table-striped table-bordered" style="width:75%; margin-left:40%; position:absolute; margin-top:16%" >
     
     <style>
         #colab-list_paginate{
            margin-top: 80%;
            margin-left: 174%;
            position:absolute;
         }
         
        .page-item.active .page-link {
            z-index: 1; 
            z-index: 2;
            z-index: 3;
            z-index: 4;
            color: grey;
            border: solid 2px;
            background-color: transparent;
            border-color: greenyellow;
            font-weight: bold;
}
         
         #colab-list_filter{
             margin-top: -40%;
            margin-left: 180%;
            position:absolute;
         }
         
         #colab-list_length{
             margin-top: -7%;
            margin-left: 81%;
            position:absolute;
         }
         
         #colab-list_length select {
             font-size: 15px;
             padding-right: 5px;
             display:inline-block;
         }
         
         #colab-list_info{
            margin-top: 111%;
            margin-left: 99%;
            position:absolute; 
            display: block;
            width:220px;
           
            
         }
         
         
         
     </style>   
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Nome</th>
                <th scope="col">Username</th>
                <th scope="col">Email</th>
                <th scope="col">Password</th>
                <th scope="col">Contactos</th>
                <th scope="col">Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <!-- Needed for DataTables -->
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
	

    <script>
    
window.onload=()=>{
        
        function listColab() {
            let table = $('#colab-list').DataTable();
            
            fetch(`http://3.236.239.191:8080/colaborators1`, { method: 'GET',
            headers: {'Accept': 'application/json',
                      'Content-Type': 'application/json'}})
                      
            .then(res => res.json())
            //.then(json => console.log(json))
            .then((out) => {
                //console.log(out);
                $.each(out, function(index, value) {
                    //console.log(value);
                    
                    table.row.add([value.idColaborator, 
                                    value.Name, 
                                    value.Username, 
                                    value.Email, 
                                    value.Password, 
                                    value.Telephone,
                                    `
                                     <button id='${value.idColaborator}' onclick="deleteData(${value.idColaborator})" style="background-color:transparent; border:none; width: 15px"><i class="fas fa-trash"></i></button>
                                     <button id='${value.idColaborator}' onclick="saveData(${value.idColaborator})" style="background-color:transparent; border:none;width: 15px"><i class="fas fa-save"></i></button>
                                     <button id='${value.idColaborator}' onclick="editData(${value.idColaborator})" style="background-color:transparent; border:none; width: 15px"><i class="far fa-edit"></i></button>`]).draw();
                });
                }).catch(err => console.error(err));
                
        }
        
        $(document).ready(function() {
            $('#colab-list').DataTable();
			listColab();
        })
        
}
//DELETE
function deleteData(id){
        swal({
                title: 'Tem a certeza?',
                text: "Nao sera possivel reverter a remocao!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Cancelar',
                confirmButtonText: 'Remover'
            }).then( async (result) => {
                if (result.value) {                        
                        //let idColaborator = btnDelete[i].getAttribute("id")
                        try {
                            const response = await fetch(`http://3.236.239.191:8080/colaborators1/${id}`, { method: "DELETE"})
                            const colaborators = await response.json()                            
                            swal('Removido!','O colaborador foi removido da tabela.','success')

                        } catch(err) {
                            swal({type: 'error', title: 'Erro', text: err})
                        }
                        const trs = document.getElementsByTagName("tr")  //linhas
                        console.log(trs);
                    for(tr of trs){
                        //console.log(tr.rowIndex)
                        console.log(tr.cells[0].innerHTML)  //id
                        if(tr.cells[0].innerHTML==id){
                        console.log("HIDE")
                        tr.hidden=true;
                        }
                    }
                } 
            })

}

//EDIT
function editData(id){
    //console.log(id);
    const trs = document.getElementsByTagName("tr")
    
            
        let index=0;
        for(tr of trs){
        if(tr.cells[0].innerHTML==id){
            tr.cells[0].innerHTML=`<input id='id${id}' placeholder="${id}" value=''>`
            tr.cells[1].innerHTML=`<input id='Name${id}' placeholder="name" value=''>`
            tr.cells[2].innerHTML=`<input id='Username${id}' placeholder="username" value=''>`
            tr.cells[3].innerHTML=`<input id='Email${id}' placeholder="email" value=''>`
            tr.cells[4].innerHTML=`<input id='Password${id}' placeholder="password" type="password" value=''>`
            tr.cells[5].innerHTML=`<input id='Telephone${id}' placeholder="Telephone$" value=''>`
        }
        }
}

//SAVE
function saveData(id){
            console.log("fetch UPDATE")
            var id_val=document.getElementById(`id${id}`).value;
            var name_val=document.getElementById(`Name${id}`).value;
            var username_val=document.getElementById(`Username${id}`).value;
            var password_val=document.getElementById(`Password${id}`).value;
            var email_val=document.getElementById(`Email${id}`).value;
            var tel_val=document.getElementById(`Telephone${id}`).value;
                swal({
                    title: 'Tem a certeza?',
                    text: "Esta linha sera alterada na base de dados!",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3075d6',
                    cancelButtonColor: '#d34',
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Alterar'
                  }).then( async (result) => {
                    if (result.value) {
                        
                        try {
                            const response = await fetch(`http://3.236.239.191:8080/colaborators1/${id}`,{method: "PUT",body: `Name=${name_val}&Username=${username_val}&Email=${email_val}&Password=${password_val}&Telephone=${tel_val}`,
                            headers: {"Content-type": "application/x-www-form-urlencoded"}});
                            const colaborators = await response.json()                            
                            swal('Actualizado!','O Colaborador foi alterado na base de dados.','success')
                            
                        } catch(err) {
                            swal({type: 'error', title: 'Erro', text: err})
                        }
                    }
                    
                    console.log(document.getElementById(`id${id}`))
                    console.log(document.getElementById(`id${name_val}`))
                    console.log(document.getElementById(`id${username_val}`))
                    console.log(document.getElementById(`id${password_val}`))
                    console.log(document.getElementById(`id${email_val}`))
                    var idcol = document.getElementById(`id${tel_val}`)
                    
                    idcol=id_val;
                    document.getElementById(`Name${id}`).innerHTML=`<td id='Name${id}'>${name_val}`;
                    document.getElementById(`Username${id}`).innerHTML=`<td id='Username${id}'>${username_val}`;
                    document.getElementById(`Password${id}`).innerHTML=`<td id='Password${id}'>${password_val}`;
                    document.getElementById(`Email${id}`).innerHTML=`<td id='Email${id}'>${email_val}`;
                    document.getElementById(`Telephone${id}`).innerHTML=`<td id='Telephone${id}'>${tel_val}`;
                  })
        
}


    </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.26.9/sweetalert2.all.min.js"></script>
  </body>
</html>