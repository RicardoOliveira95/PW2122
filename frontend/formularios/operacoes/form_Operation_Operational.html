<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="/_sidebar.css">
    <link rel="stylesheet" href="/style.css" crossorigin="anonymous"></linkrel>
    
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400">
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
    <title>ASAE | Operacionais de uma Operação </title>

    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400">
    <link rel="stylesheet" href="/style.css" crossorigin="anonymous"></linkrel>
    <link href="/_sidebar.scss" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">
    <meta charset="UTF-8">
    <link rel="icon" href="/_img/Imgs/SimboloASAE_personalizado.jpeg.sb-e501c02c-7jNvGZ.png"> 
  </head>
  <body>
   
      
         <div class="lateral_menu" style="position: absolute; height: 100%;">
            <!--Identification of the user who is logged in the system-->
            <div class="identify">
                <img src="/_img/Imgs/1499345621-contact_85338.png" alt="">
                <a href="#" > <h3 style="margin-left: 30%;"> Username logado</h3></a>
                <br>
                <br>
                
                <a href="" style="margin: 5%;"><button class="logoutRevervado" onclick="" style="border: 1px solid #fff; margin-left: 37%; margin-top: 5%;"> <span style="font-size: 12px; text-align: center;padding-left: 2px; "> LogOut </span></button></a> 
            </div>
    
            <!--Options - load new pages-->
            <div class="menuOptions">
                
                <!--go to the page with the list of the request not awnser-->
                <div class="options">
                <i class="far fa-clock" style="margin-left: 15%;"></i> 
                <a href="/pedidosPendentes.html" style="margin-top: 5%; margin-left: 25%; margin-bottom: 3%"> Pedidos Pendentes</a>
                <br><br>
            </div>
            
                
                <div class="options">
                <i class="fas fa-network-wired" style="margin-left: 15%;"></i> 
                <a href="/registarOperacao.html" style="margin-top: 5%;margin-left: 25%;" > Gerir Ocorrência</a>
                
                <br><br>
            </div>
                
            <div class="options">
                <i class="far fa-address-card" style="margin-left: 15%;"></i>
                <a href="/registarOperacao.html" style="margin-top: 5%;margin-left: 25%; "  > Entidades</a>
                
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-user-secret" style="margin-left: 15%;"></i>
                <a href="/registarOperacao.html" style="margin-top: 5%;margin-left: 25%;" > Denunciantes</a>
                
                <br><br>
            </div>
            
            
            <div class="options">
                <i class="far fa-building" style="margin-left: 15%;"></i> 
                <a href="/centros.html" style="margin-top: 5%;margin-left: 25%;"> Colaboradores</a>
                <br><br>
            </div>
            
            <div class="options">
              
                <i class="far fa-address-book" style="margin-left: 15%;"></i> 
                <a href="/operacionais.html" style="margin-top: 4%;margin-left: 25%; color: greenyellow; font-size: 22px;"> Operacionais</a>
                    <ul style="margin-top: 20%; margin-right:20%; position:absolute">
                        <li>Lista de Operacionais</li>
                        <li>Operacionais de uma Operação</li>
                    </ul>
               
                <!--style="position: absolute; display:none; top:25px; left:0; background-color:#fff;"-->

                
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-hard-hat" style="margin-left: 15%;"></i> 
                <a href="/parceiros.html" style="margin-top: 5%;margin-left: 25%;"> Parceiros</a>
                <br><br>
            </div>
            
            <div class="options">
                <i class="fas fa-chart-line" style="margin-left: 15%;"></i> 
                <a href="#" style="margin-top: 5%;margin-left: 25%;"> Dashboard </a>
                <br><br>
            </div>
    
            </div>
            
            </div>

   <div class="content_tables" style="height:78%;">


    <div class="pedidosPendentes" style="position: absolute; display: inline;">
        <h1 style="font-style: italic;">Operacionais de uma Operação</h1> <img src="/_img/Imgs/Sem nome.png" alt="" style="display: inline; width: 60px; height: 30px; position: absolute;">            
     
    </div>

    <div class="tabela" style="width: 80%; height: 47%;margin-top: 27%; margin-left:0%">
    <table class="table" id="myDataTable"></table>
</div>
</div>   
       
      
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->

    <script type="text/javascript" src="//cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
        $(document).ready( function () {
    $('#myDataTable').DataTable();
} );
    </script>

<!--Editar tabela-->
<script>
$(".editar").click(function(){
    var id = $(this).data('id');
    var titulo = $(this).data('titulo');
    var autor = $(this).data('autor');
    var categoria = $(this).data('categoria');
    //preenche os campos e chama o modal
})
</script>
<script type="text/javascript">
	window.onload=()=>{
const myDataTable = document.getElementById("myDataTable")

//GET
const renderoperation_operational = async () => {
        let strHtml = `
             <thead>
            <tr>
                <th>Id Operação</th>
                
                <th>Id Operacional</th>
               
                <th>Ações</th>
                <th>
            
                <input type="text" placeholder="Search" name="search" id="query" onkeyup="searchData()" style="width: 150px; height:30px; display:inline;">
               <!-- <button type="submit" value="search" onclick="searchData()" style="backgound-color: white; border:none;"><i class="fas fa-search"></i>-->
                </th>
                
                
                
            </tr>
     </thead><tbody>
        `
        const response = await fetch('http://3.234.222.199:8080/operations/:idOperation/operationals/')
        const operation_operational = await response.json()
        let i = 1
        for (const ope_ope of operation_operational) {            
            strHtml += `<tr>
                    <td id="row${ope_ope.idOperation}">  ${ope_ope.idOperation}</td>
                   
                    <td id="name_row${ope_ope.idOperational}">  ${ope_ope.idOperational} </td> 
                    
                    <td>
                    <p>
                     <i id='${ope_ope.idOperational}' class='fas fa-trash-alt remove'></i>  
                    <br>
                    <p> <i class="far fa-edit" id="edit_button${ope_ope.idOperational}" value="Edit" class="edit" onclick="edit_row('${ope_ope.idOperational}')"></i> 
                    <br>
                    <p> <i name="${ope_ope.idOperational}" id="save_button${ope_ope.idOperational}" value="Save" class="fa fa-save" onclick="save_row('${ope_ope.idOperational}')">
                    </td> 
                </tr>`
            i++
        }
        
        strHtml += "</tbody>"
        myDataTable.innerHTML = strHtml
        
        
        //DELETE
        const btnDelete = document.getElementsByClassName("remove")
        for (let i = 0; i < btnDelete.length; i++) {
            btnDelete[i].addEventListener("click", () => {
                swal({
                    title: 'Tem a certeza?',
                    text: "Nao sera possivel reverter a remocao!",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Remover'
                  }).then( async (result) => {
                    if (result.value) {                        
                        let idOperation = btnDelete[i].getAttribute("id")
                        let idOperational = btnDelete[i].getAttribute("id")
                        try {
                            const response = await fetch(`http://3.234.222.199:8080/operations/${idOperation}/operationals/${idOperational}`, { method: "DELETE"})
                            const operation_operational = await response.json()                            
                            swal('Removido!','O operacional foi removido da operacao na tabela.','success')
                            renderoperation_operational()
                        } catch(err) {
                            swal({type: 'error', title: 'Erro', text: err})
                        }
                    } 
                  })
            })
        }
        
        //UPDATE
        const saveBtn = document.getElementsByClassName("fa fa-save")
        for (let i = 0; i < saveBtn.length; i++) {
            saveBtn[i].addEventListener("click", () => {
                console.log("fetch")
                swal({
                    title: 'Tem a certeza?',
                    text: "Esta linha sera alterada na base de dados!",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3075d6',
                    cancelButtonColor: '#d34',
                    cancelButtonText: 'Cancelar',
                    confirmButtonText: 'Alterar'
                  }).then( async (result) => {
                    if (result.value) {                        
                        let idOperation = saveBtn[i].getAttribute("name")
                        var idOperational=saveBtn[i].getAttribute("name_row")
                        console.log(idOperational);
                        try {
                            const response = await fetch(`http://3.234.222.199:8080/operations/${idOperation}/operationals/`, { method: "PUT",body: `idOperational=${idOperational}`,
                                headers: {"Content-type": "application/x-www-form-urlencoded"}})
                            const operation_operational = await response.json()                            
                            swal('Actualizado!','O operacional foi alterado na base de dados.','success')
                        } catch(err) {
                            swal({type: 'error', title: 'Erro', text: err})
                        }
                    } 
                  })
            })
        }
        }
        renderoperation_operational()
    }
    function edit_row(no){
        console.log("estou aqui");
    document.getElementById("edit_button"+no).style.display="none";
    document.getElementById("save_button"+no).style.display="block";
    console.log(document.getElementById("edit_button"+no));
    
    var idoperational=document.getElementById("name_row"+no);
 
    var idoperational_data=idoperational.innerHTML;
    
    idoperational.innerHTML="<input type='text' id='idOperational_text"+no+"' value='"+idoperational_data+"'>";
 
        
    }
    
function save_row(no){
console.log("save")

 document.getElementById("edit_button"+no).style.display="block";
 document.getElementById("save_button"+no).style.display="none";
 
 var idoperational_val=document.getElementById("idoperational_text"+no).value;
 
 document.getElementById("name_row"+no).innerHTML=idoperational_val;
 
 document.getElementById("edit_button"+no).style.display="block";
 document.getElementById("save_button"+no).style.display="none";

 var idoperational=document.getElementById("name_row"+no);

}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.26.9/sweetalert2.all.min.js"></script>
  </body>
</html>
