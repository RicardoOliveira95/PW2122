{"filter":false,"title":"requests.js","tooltip":"/backend/controllers/requests.js","undoManager":{"mark":67,"position":67,"stack":[[{"start":{"row":26,"column":5},"end":{"row":26,"column":6},"action":"remove","lines":["/"],"id":2},{"start":{"row":26,"column":4},"end":{"row":26,"column":5},"action":"remove","lines":["/"]}],[{"start":{"row":25,"column":0},"end":{"row":25,"column":1},"action":"insert","lines":["/"],"id":3},{"start":{"row":25,"column":1},"end":{"row":25,"column":2},"action":"insert","lines":["*"]}],[{"start":{"row":51,"column":3},"end":{"row":51,"column":4},"action":"insert","lines":["*"],"id":4},{"start":{"row":51,"column":4},"end":{"row":51,"column":5},"action":"insert","lines":["/"]}],[{"start":{"row":51,"column":4},"end":{"row":51,"column":5},"action":"remove","lines":["/"],"id":5},{"start":{"row":51,"column":3},"end":{"row":51,"column":4},"action":"remove","lines":["*"]}],[{"start":{"row":25,"column":1},"end":{"row":25,"column":2},"action":"remove","lines":["*"],"id":6},{"start":{"row":25,"column":0},"end":{"row":25,"column":1},"action":"remove","lines":["/"]}],[{"start":{"row":40,"column":64},"end":{"row":41,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":41,"column":0},"end":{"row":41,"column":20},"action":"insert","lines":["                    "]}],[{"start":{"row":41,"column":20},"end":{"row":41,"column":54},"action":"insert","lines":["res.redirect('/registardenuncia2')"],"id":8}],[{"start":{"row":41,"column":36},"end":{"row":41,"column":52},"action":"remove","lines":["egistardenuncia2"],"id":9},{"start":{"row":41,"column":35},"end":{"row":41,"column":36},"action":"remove","lines":["r"]}],[{"start":{"row":41,"column":34},"end":{"row":41,"column":35},"action":"remove","lines":["/"],"id":10}],[{"start":{"row":41,"column":34},"end":{"row":41,"column":40},"action":"insert","lines":["/login"],"id":11}],[{"start":{"row":41,"column":20},"end":{"row":41,"column":21},"action":"insert","lines":["/"],"id":12},{"start":{"row":41,"column":21},"end":{"row":41,"column":22},"action":"insert","lines":["/"]}],[{"start":{"row":41,"column":21},"end":{"row":41,"column":22},"action":"remove","lines":["/"],"id":13},{"start":{"row":41,"column":20},"end":{"row":41,"column":21},"action":"remove","lines":["/"]}],[{"start":{"row":3,"column":21},"end":{"row":4,"column":0},"action":"insert","lines":["",""],"id":14}],[{"start":{"row":4,"column":0},"end":{"row":6,"column":42},"action":"insert","lines":["const express = require('express');","","app.use(express.static('../../frontend'));"],"id":15}],[{"start":{"row":54,"column":12},"end":{"row":54,"column":13},"action":"insert","lines":["/"],"id":16},{"start":{"row":54,"column":13},"end":{"row":54,"column":14},"action":"insert","lines":["/"]}],[{"start":{"row":35,"column":8},"end":{"row":35,"column":9},"action":"insert","lines":["/"],"id":17},{"start":{"row":35,"column":9},"end":{"row":35,"column":10},"action":"insert","lines":["/"]}],[{"start":{"row":34,"column":8},"end":{"row":34,"column":17},"action":"remove","lines":["idAccuser"],"id":18},{"start":{"row":34,"column":8},"end":{"row":34,"column":19},"action":"insert","lines":["Description"]}],[{"start":{"row":34,"column":33},"end":{"row":34,"column":41},"action":"remove","lines":["idEntity"],"id":19},{"start":{"row":34,"column":33},"end":{"row":34,"column":44},"action":"insert","lines":["Description"]}],[{"start":{"row":40,"column":12},"end":{"row":40,"column":184},"action":"remove","lines":["const query = bd.connection.query(`if exists (SELECT * FROM Accusers`+filter+') INSERT INTO Requests SET ? ELSE SELECT * FROM Operations', post, function(err, rows, fields)"],"id":20},{"start":{"row":40,"column":12},"end":{"row":40,"column":109},"action":"insert","lines":["const query = bd.connection.query('INSERT INTO Entities SET ?', post, function(err, rows, fields)"]}],[{"start":{"row":40,"column":59},"end":{"row":40,"column":67},"action":"remove","lines":["Entities"],"id":21},{"start":{"row":40,"column":59},"end":{"row":40,"column":60},"action":"insert","lines":["R"]},{"start":{"row":40,"column":60},"end":{"row":40,"column":61},"action":"insert","lines":["e"]},{"start":{"row":40,"column":61},"end":{"row":40,"column":62},"action":"insert","lines":["q"]}],[{"start":{"row":40,"column":59},"end":{"row":40,"column":62},"action":"remove","lines":["Req"],"id":22},{"start":{"row":40,"column":59},"end":{"row":40,"column":67},"action":"insert","lines":["Requests"]}],[{"start":{"row":35,"column":8},"end":{"row":37,"column":34},"action":"remove","lines":["//let filter = ' WHERE idAccuser= '+idAccuser;","        //const checkId = bd.connection.query(`SELECT * FROM Accusers`+filter,res);","        //console.log(checkId.sql)"],"id":23},{"start":{"row":35,"column":4},"end":{"row":35,"column":8},"action":"remove","lines":["    "]},{"start":{"row":35,"column":0},"end":{"row":35,"column":4},"action":"remove","lines":["    "]},{"start":{"row":34,"column":57},"end":{"row":35,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":34,"column":29},"end":{"row":34,"column":54},"action":"remove","lines":[" && Description != \"NULL\""],"id":24}],[{"start":{"row":34,"column":29},"end":{"row":34,"column":30},"action":"insert","lines":[" "],"id":25}],[{"start":{"row":34,"column":30},"end":{"row":34,"column":60},"action":"insert","lines":["&& typeof(Name) != \"undefined\""],"id":26}],[{"start":{"row":34,"column":40},"end":{"row":34,"column":44},"action":"remove","lines":["Name"],"id":27},{"start":{"row":34,"column":40},"end":{"row":34,"column":41},"action":"insert","lines":["D"]},{"start":{"row":34,"column":41},"end":{"row":34,"column":42},"action":"insert","lines":["e"]},{"start":{"row":34,"column":42},"end":{"row":34,"column":43},"action":"insert","lines":["s"]}],[{"start":{"row":34,"column":40},"end":{"row":34,"column":43},"action":"remove","lines":["Des"],"id":28},{"start":{"row":34,"column":40},"end":{"row":34,"column":51},"action":"insert","lines":["Description"]}],[{"start":{"row":32,"column":4},"end":{"row":32,"column":5},"action":"insert","lines":["/"],"id":29},{"start":{"row":32,"column":5},"end":{"row":32,"column":6},"action":"insert","lines":["/"]}],[{"start":{"row":33,"column":4},"end":{"row":33,"column":5},"action":"insert","lines":["/"],"id":30},{"start":{"row":33,"column":5},"end":{"row":33,"column":6},"action":"insert","lines":["/"]}],[{"start":{"row":35,"column":63},"end":{"row":35,"column":104},"action":"remove","lines":[" idAccuser: idAccuser, idEntity: idEntity"],"id":31},{"start":{"row":35,"column":62},"end":{"row":35,"column":63},"action":"remove","lines":[","]}],[{"start":{"row":45,"column":47},"end":{"row":46,"column":0},"action":"insert","lines":["",""],"id":32},{"start":{"row":46,"column":0},"end":{"row":46,"column":20},"action":"insert","lines":["                    "]}],[{"start":{"row":46,"column":20},"end":{"row":46,"column":54},"action":"insert","lines":["res.redirect('/registardenuncia1')"],"id":33}],[{"start":{"row":46,"column":51},"end":{"row":46,"column":52},"action":"remove","lines":["1"],"id":34}],[{"start":{"row":46,"column":51},"end":{"row":46,"column":52},"action":"insert","lines":["2"],"id":35}],[{"start":{"row":46,"column":51},"end":{"row":46,"column":52},"action":"remove","lines":["2"],"id":36}],[{"start":{"row":46,"column":51},"end":{"row":46,"column":52},"action":"insert","lines":["3"],"id":37}],[{"start":{"row":4,"column":35},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":38}],[{"start":{"row":5,"column":0},"end":{"row":7,"column":21},"action":"insert","lines":["const express = require('express');","const { body, validationResult } = require('express-validator');","app.use('/', router);"],"id":39}],[{"start":{"row":4,"column":35},"end":{"row":5,"column":35},"action":"remove","lines":["","const express = require('express');"],"id":40}],[{"start":{"row":3,"column":0},"end":{"row":3,"column":21},"action":"remove","lines":["app.use('/', router);"],"id":41},{"start":{"row":2,"column":39},"end":{"row":3,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":54,"column":3},"end":{"row":55,"column":0},"action":"insert","lines":["",""],"id":42},{"start":{"row":55,"column":0},"end":{"row":56,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":56,"column":0},"end":{"row":86,"column":3},"action":"insert","lines":["router.post('/entities',[","    body('Name').not().isEmpty().withMessage('Name is a required field'),","    body('District').isEmpty().withMessage('District is a required field'),","    body('Zip_Code').isLength({min: 4, max: 8}).withMessage('Zip_Code should have between 4 and 8 chars')","], function(req, res) {","    const errors = validationResult(req);","","    if (!errors.isEmpty()) {","      return res.status(400).json({ errors: errors.array() });","    }","    const idEntity = req.body.idEntity;","    const Name = req.body.Name;","    //const Type = req.body.Type;","    const Street = req.body.Street;","    const District = req.body.District;","    const Zip_Code = req.body.Zip_Code;","    const post = {Name: Name, Street: Street, District: District, Zip_Code: Zip_Code};","    const query = bd.connection.query('INSERT INTO Entities SET ?', post, function(err, rows, fields) {","                console.log(query.sql);","                if (!err) {","                    console.log(\"Database succesfully updated.\")","                    res.redirect('/registardenuncia3')","                }","                else {","                    console.log(err);","                    console.log(\"data missing\")","                    res.redirect('/registardenuncia2')","                }","            });","            //res.end();","});"],"id":43}],[{"start":{"row":56,"column":14},"end":{"row":56,"column":22},"action":"remove","lines":["entities"],"id":44},{"start":{"row":56,"column":14},"end":{"row":56,"column":22},"action":"insert","lines":["requests"]}],[{"start":{"row":57,"column":10},"end":{"row":57,"column":14},"action":"remove","lines":["Name"],"id":45},{"start":{"row":57,"column":10},"end":{"row":57,"column":14},"action":"insert","lines":["Type"]}],[{"start":{"row":57,"column":46},"end":{"row":57,"column":50},"action":"remove","lines":["Name"],"id":46},{"start":{"row":57,"column":46},"end":{"row":57,"column":50},"action":"insert","lines":["Type"]}],[{"start":{"row":59,"column":10},"end":{"row":59,"column":18},"action":"remove","lines":["Zip_Code"],"id":47},{"start":{"row":59,"column":10},"end":{"row":59,"column":21},"action":"insert","lines":["Description"]}],[{"start":{"row":59,"column":47},"end":{"row":59,"column":48},"action":"remove","lines":["8"],"id":48}],[{"start":{"row":59,"column":47},"end":{"row":59,"column":48},"action":"insert","lines":["1"],"id":49},{"start":{"row":59,"column":48},"end":{"row":59,"column":49},"action":"insert","lines":["6"]},{"start":{"row":59,"column":49},"end":{"row":59,"column":50},"action":"insert","lines":["6"]}],[{"start":{"row":59,"column":49},"end":{"row":59,"column":50},"action":"remove","lines":["6"],"id":50},{"start":{"row":59,"column":48},"end":{"row":59,"column":49},"action":"remove","lines":["6"]}],[{"start":{"row":59,"column":48},"end":{"row":59,"column":49},"action":"insert","lines":["5"],"id":51},{"start":{"row":59,"column":49},"end":{"row":59,"column":50},"action":"insert","lines":["5"]}],[{"start":{"row":59,"column":39},"end":{"row":59,"column":40},"action":"remove","lines":["4"],"id":52}],[{"start":{"row":59,"column":39},"end":{"row":59,"column":40},"action":"insert","lines":["1"],"id":53}],[{"start":{"row":59,"column":66},"end":{"row":59,"column":74},"action":"remove","lines":["Zip_Code"],"id":54},{"start":{"row":59,"column":66},"end":{"row":59,"column":77},"action":"insert","lines":["Description"]}],[{"start":{"row":57,"column":73},"end":{"row":58,"column":75},"action":"remove","lines":["","    body('District').isEmpty().withMessage('District is a required field'),"],"id":55}],[{"start":{"row":65,"column":4},"end":{"row":70,"column":39},"action":"remove","lines":["const idEntity = req.body.idEntity;","    const Name = req.body.Name;","    //const Type = req.body.Type;","    const Street = req.body.Street;","    const District = req.body.District;","    const Zip_Code = req.body.Zip_Code;"],"id":56},{"start":{"row":65,"column":4},"end":{"row":69,"column":41},"action":"insert","lines":["const idRequest = req.body.idRequest;","    const Type = req.body.Type;","    const Description = req.body.Description;","    //const idAccuser = req.body.idAccuser;","    //const idEntity = req.body.idEntity;"]}],[{"start":{"row":70,"column":4},"end":{"row":70,"column":86},"action":"remove","lines":["const post = {Name: Name, Street: Street, District: District, Zip_Code: Zip_Code};"],"id":57},{"start":{"row":70,"column":4},"end":{"row":70,"column":56},"action":"insert","lines":["const post = {Type: Type ,Description: Description};"]}],[{"start":{"row":71,"column":51},"end":{"row":71,"column":59},"action":"remove","lines":["Entities"],"id":58},{"start":{"row":71,"column":51},"end":{"row":71,"column":52},"action":"insert","lines":["R"]},{"start":{"row":71,"column":52},"end":{"row":71,"column":53},"action":"insert","lines":["e"]}],[{"start":{"row":71,"column":53},"end":{"row":71,"column":54},"action":"insert","lines":["q"],"id":59}],[{"start":{"row":71,"column":51},"end":{"row":71,"column":54},"action":"remove","lines":["Req"],"id":60},{"start":{"row":71,"column":51},"end":{"row":71,"column":59},"action":"insert","lines":["Requests"]}],[{"start":{"row":75,"column":51},"end":{"row":75,"column":52},"action":"remove","lines":["3"],"id":61},{"start":{"row":75,"column":50},"end":{"row":75,"column":51},"action":"remove","lines":["a"]},{"start":{"row":75,"column":49},"end":{"row":75,"column":50},"action":"remove","lines":["i"]},{"start":{"row":75,"column":48},"end":{"row":75,"column":49},"action":"remove","lines":["c"]},{"start":{"row":75,"column":47},"end":{"row":75,"column":48},"action":"remove","lines":["n"]},{"start":{"row":75,"column":46},"end":{"row":75,"column":47},"action":"remove","lines":["u"]},{"start":{"row":75,"column":45},"end":{"row":75,"column":46},"action":"remove","lines":["n"]},{"start":{"row":75,"column":44},"end":{"row":75,"column":45},"action":"remove","lines":["e"]},{"start":{"row":75,"column":43},"end":{"row":75,"column":44},"action":"remove","lines":["d"]},{"start":{"row":75,"column":42},"end":{"row":75,"column":43},"action":"remove","lines":["r"]},{"start":{"row":75,"column":41},"end":{"row":75,"column":42},"action":"remove","lines":["a"]},{"start":{"row":75,"column":40},"end":{"row":75,"column":41},"action":"remove","lines":["t"]},{"start":{"row":75,"column":39},"end":{"row":75,"column":40},"action":"remove","lines":["s"]},{"start":{"row":75,"column":38},"end":{"row":75,"column":39},"action":"remove","lines":["i"]},{"start":{"row":75,"column":37},"end":{"row":75,"column":38},"action":"remove","lines":["g"]}],[{"start":{"row":75,"column":36},"end":{"row":75,"column":37},"action":"remove","lines":["e"],"id":62},{"start":{"row":75,"column":35},"end":{"row":75,"column":36},"action":"remove","lines":["r"]}],[{"start":{"row":75,"column":35},"end":{"row":75,"column":36},"action":"insert","lines":["l"],"id":63},{"start":{"row":75,"column":36},"end":{"row":75,"column":37},"action":"insert","lines":["o"]},{"start":{"row":75,"column":37},"end":{"row":75,"column":38},"action":"insert","lines":["g"]},{"start":{"row":75,"column":38},"end":{"row":75,"column":39},"action":"insert","lines":["i"]},{"start":{"row":75,"column":39},"end":{"row":75,"column":40},"action":"insert","lines":["n"]}],[{"start":{"row":80,"column":51},"end":{"row":80,"column":52},"action":"remove","lines":["2"],"id":64}],[{"start":{"row":80,"column":51},"end":{"row":80,"column":52},"action":"insert","lines":["3"],"id":65}],[{"start":{"row":29,"column":0},"end":{"row":54,"column":3},"action":"remove","lines":["router.post('/requests', (req, res) =>{","    const idRequest = req.body.idRequest;","    const Type = req.body.Type;","    const Description = req.body.Description;","    //const idAccuser = req.body.idAccuser;","    //const idEntity = req.body.idEntity;","    if (Description != \"NULL\" && typeof(Description) != \"undefined\") {","            const post = {Type: Type ,Description: Description};","            //criar e executar a query de gravação na BD para inserir os dados presentes no post","            const query = bd.connection.query('INSERT INTO Requests SET ?', post, function(err, rows, fields) {","                console.log(query.sql);","                if (!err) {","                    console.log(\"Database succesfully updated.\")","                    res.redirect('/login')","                }","                else {","                    console.log(err);","                    console.log(\"data missing\")","                    res.redirect('/registardenuncia3')","                }","            });","        }","        else","            console.log(\"data\")","            //res.end();","});"],"id":66}],[{"start":{"row":30,"column":0},"end":{"row":31,"column":0},"action":"remove","lines":["",""],"id":67},{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"remove","lines":["",""]},{"start":{"row":28,"column":7},"end":{"row":29,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":28,"column":7},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":68}],[{"start":{"row":48,"column":35},"end":{"row":48,"column":40},"action":"remove","lines":["login"],"id":69}]]},"ace":{"folds":[],"scrolltop":393.5,"scrollleft":0,"selection":{"start":{"row":48,"column":35},"end":{"row":48,"column":35},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":148,"mode":"ace/mode/javascript"}},"timestamp":1610295851871,"hash":"4ec409a0225d0f1bcf293b7b97f6cfcbb901c99a"}